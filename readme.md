# WB Tariffs to Google Sheets (Тарифы WB в Google Таблицы)

Это приложение получает тарифы из API Wildberries, сохраняет их в базе данных PostgreSQL и обновляет Google Таблицу с данными о тарифах.

## Предварительные требования

-   Docker и Docker Compose
-   Node.js и npm (для локальной разработки)

## Начало работы

1.  **Клонируйте репозиторий:**
    ```bash
    git clone <repository-url>
    cd <repository-name>
    ```

2.  **Настройте переменные окружения и учетные данные:**

    -   Создайте файл `.env` в корне проекта, скопировав файл `example.env`:
        ```bash
        cp example.env .env
        ```
    -   Откройте файл `.env` и заполните необходимые значения:
        -   `WILDBERRIES_API_KEY`: Ваш API-ключ для API Wildberries.
        -   `GOOGLE_SHEET_IDS`: Список ID Google Таблиц для обновления, разделенный запятыми.
    -   Поместите ваш JSON-ключ сервисного аккаунта Google в корневой каталог проекта и назовите его `gcreds.json`.

3.  **Запустите приложение:**
    ```bash
    docker compose up --build -d
    ```

## Как это работает

Приложение состоит из двух сервисов:

-   `postgres`: База данных PostgreSQL для хранения тарифов.
-   `app`: Приложение Node.js, которое:
    -   Выполняет миграции базы данных при запуске.
    -   Запускает планировщик, который работает каждый час.
    -   Планировщик получает тарифы из API Wildberries за текущий день.
    -   Полученные тарифы сохраняются в базу данных (с обновлением при конфликте).
    -   Затем планировщик обновляет Google Таблицы последними данными о тарифах из базы данных.

## Интеграция с Google Sheets

Для включения интеграции с Google Sheets вам необходимо:

1.  **Создать сервисный аккаунт Google** и скачать JSON-ключ.
2.  **Переименовать скачанный файл в `gcreds.json`** и поместить его в корень проекта.
3.  **Включить Google Sheets API** для вашего проекта в Google Cloud Console.
4.  **Поделиться вашей Google Таблицей** с адресом электронной почты сервисного аккаунта, предоставив ему права "Редактора".
5.  **Установить переменную окружения `GOOGLE_SHEET_IDS`** в файле `.env`.

Приложение будет обновлять лист с именем `stocks_coefs` в каждой из указанных Google Таблиц.
